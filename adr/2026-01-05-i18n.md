# Реализация мультиязычности (i18n)

## Контекст

Проект требует поддержки нескольких языков: русский как основной, английский как дополнительный.
Требования к мультиязычности:

- Основной язык (русский) можно задать в настройках.
- Основной язык отображается без префикса: `example.com/news`.
- Дополнительные языки имеют префикс: `example.com/en/news`.
- URL должны быть SEO-friendly.
- URL должно быть легко строить из php кода и шаблонов blade — не должно быть обязательным передавать текущую локаль для каждой ссылки.
- Не должно быть обязательным каждый маршрут объявлять дважды.
- Внутренние маршруты Laravel и пакетов composer (например, Livewire) не должны терять локаль пользователя. Например, если человек пользуется английской версией сайта, то при взаимодействии с компонентом Livewire должен остаться английский язык.
- Выбранный язык должен быть доступен в компонентах Livewire как для веб-запросов, так и для автотестов.
- Функция `route()` для построения ссылок никогда не используется.
- Должна быть возможность построить ссылку на страницу с языком пользователя. Например, для писем или уведомлений.
- Список поддерживаемых локализаций в ключах `config('cfg.locales')`.

## Решение

Использовать стандартный механизм маршрутизации Laravel, подключая файлы маршрутов дважды: один раз в корне, второй раз в группе с префиксом `en`. Это позволяет обрабатывать URL вида `/en/news` и `/news` одним и тем же контроллером.

Определять текущую локаль в Middleware `SetLocale` на основе первого сегмента URL. Для Livewire запросов определять локаль по заголовку `Referer`. Если локаль не найдена, то использовать язык по умолчанию.

Не определять локаль вне PHP. Приложение должно быть самодостаточным.

Адаптировать глобальные хелперы `path()` и `to()` для использования текущей локали приложения (`app()->getLocale()`) и автоматического добавления префикса.

## Статус

Реализовано.
