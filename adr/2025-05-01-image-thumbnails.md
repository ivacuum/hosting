# Произвольные миниатюры изображений

## Контекст

Изображения сайта должны быть небольшой ширины и высоты для показа на устройствах с маленьким экраном, вроде мобильных телефонов. Так как дизайн сайта может меняться, нужно иметь возможность запрашивать миниатюру произвольного размера. Миниатюра будет создаваться из оригинального большого изображения.

## Решение

Создать специальный префикс на домене со статикой, чтобы изображение было отдано в пределах запрошенного размера.
> https://life.ivacuum.org/-/500x375/novi-sad.2023/IMG_1899.jpg

При этом nginx на life.ivacuum.org проверит собственный кэш на наличие этой миниатюры. Если найдет, то сразу вернет картинку. Если не найдет, то для получения миниатюры сделает следующий запрос:
> https://vacuum.name/resize/500x375/life.ivacuum.org/novi-sad.2023/IMG_1899.jpg

В свою очередь, скрипт скачает изображение максимального размера.
> https://life.ivacuum.org/novi-sad.2023/IMG_1899.jpg

Сделает из него миниатюру и отдаст в ответе. Скрипт не должен устанавливать куки в ответе, чтобы cloudflare мог его закэшировать.

## Альтернативы

Следующий адрес скрипта не подошел, потому что cloudflare не считает его пригодным к кэшированию, выдавая заголовок `cf-cache-status: DYNAMIC`
> https://vacuum.name/resize/500x375?image=https://life.ivacuum.org/novi-sad.2023/IMG_1899.jpg

## Статус

Реализовано.

## Последствия
